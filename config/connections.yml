# V1.1.0 Connections Configuration
# Generated from your current .env configuration
# This enables v1.1.0 multi-schema features while maintaining v1.0.0 compatibility

connections:
  # Source connections (MySQL databases)  
  sources:
    # Canada Data Warehouse Read-Only with SSH 
    CA_DW_RO_SSH:
      host: us-east-1.ro.db.analysis.uniuni.ca.internal
      port: 3306
      database: unidw
      username: "${DB_USER}"
      password: "${DB_CA_DW_RO_PASSWORD}"
      description: "Canada Data Warehouse Read-Only MySQL (US-EAST-1) via SSH tunnel"
      
      ssh_tunnel:
        enabled: true
        host: 44.209.128.227
        username: "${SSH_BASTION_USER}"
        private_key_path: "${SSH_BASTION_KEY_PATH}"
        local_port: 0  # Auto-assign

    # US Production Read-Only with SSH
    US_PROD_RO_SSH:
      host: us-west-2.ro.db.uniuni.com.internal
      port: 3306
      database: kuaisong
      username: "${DB_USER}"
      password: "${DB_US_PROD_RO_PASSWORD}"
      description: "US Production Read-Only MySQL (US-WEST-2) via SSH tunnel"
      
      ssh_tunnel:
        enabled: true
        host: 35.83.114.196
        username: "${SSH_BASTION_USER}"
        private_key_path: "${SSH_BASTION_KEY_PATH}"
        local_port: 0  # Auto-assign
    
    # US Data Warehouse Read-Only with SSH - Settlement Schema
    US_DW_RO_SSH:
      host: us-west-2.ro.db.analysis.uniuni.com.internal
      port: 3306
      database: settlement
      username: "${DB_USER}"
      password: "${DB_US_DW_RO_PASSWORD}"
      description: "US Data Warehouse Read-Only MySQL (US-WEST-2) Settlement Schema via SSH tunnel"
      
      ssh_tunnel:
        enabled: true
        host: 35.83.114.196
        username: "${SSH_BASTION_USER}"
        private_key_path: "${SSH_BASTION_KEY_PATH}"
        local_port: 0  # Auto-assign

    # US Data Warehouse with SSH - Unidw Schema  
    US_DW_UNIDW_SSH:
      host: db.analysis.uniuni.com.internal
      port: 3306
      database: unidw
      username: "${DB_USER}"
      password: "${DB_US_DW_PASSWORD}"
      description: "US Data Warehouse MySQL (US-WEST-2) Unidw Schema via SSH tunnel"
      
      ssh_tunnel:
        enabled: true
        host: 35.83.114.196
        username: "${SSH_BASTION_USER}"
        private_key_path: "${SSH_BASTION_KEY_PATH}"
        local_port: 0  # Auto-assign

    # US Data Warehouse Read-Only with SSH - Uniods Schema
    US_DW_UNIODS_SSH:
      host: us-west-2.ro.db.analysis.uniuni.com.internal
      port: 3306
      database: uniods
      username: "${DB_USER}"
      password: "${DB_US_DW_RO_PASSWORD}"
      description: "US Data Warehouse Read-Only MySQL (US-WEST-2) Uniods Schema via SSH tunnel"
      
      ssh_tunnel:
        enabled: true
        host: 35.83.114.196
        username: "${SSH_BASTION_USER}"
        private_key_path: "${SSH_BASTION_KEY_PATH}"
        local_port: 0  # Auto-assign
    
    # US QA with SSH
    US_QA_SSH:
      host: us-west-2.ro.db.qa.uniuni.com.internal
      port: 3306
      database: unidw
      username: "${DB_USER}"
      password: "${DB_US_QA_PASSWORD}"
      description: "US QA MySQL (US-WEST-2) via SSH tunnel"
      
      ssh_tunnel:
        enabled: true
        host: 35.82.216.244
        username: "${SSH_BASTION_USER}"
        private_key_path: "${SSH_BASTION_KEY_PATH}"
        local_port: 0  # Auto-assign
    
    # US Production Read-Only Direct (no SSH)
    US_PROD_RO_DIRECT:
      host: us-west-2.ro.db.uniuni.com.internal
      port: 3306
      database: kuaisong
      username: "${DB_USER}"
      password: "${DB_US_PROD_RO_PASSWORD}"
      description: "US Production Read-Only MySQL (US-WEST-2) direct connection"
      
      # No SSH tunnel configuration - direct connection
      ssh_tunnel:
        enabled: false
    
    # US Data Warehouse Direct (no SSH)
    US_DW_UNIDW_DIRECT:
      host: db.analysis.uniuni.com.internal
      port: 3306
      database: unidw
      username: "${DB_USER}"
      password: "${DB_US_DW_PASSWORD}"
      description: "US Data Warehouse MySQL (US-WEST-2) Unidw Schema via SSH tunnel"
      
      # No SSH tunnel configuration - direct connection
      ssh_tunnel:
        enabled: false
    
    # US QA Direct (no SSH)
    US_QA_RO_DIRECT:
      host: us-west-2.ro.db.qa.uniuni.com.internal
      port: 3306
      database: kuaisong
      username: "${DB_USER}"
      password: "${DB_US_QA_PASSWORD}"
      description: "US QA MySQL (US-WEST-2) direct connection"
      
      # No SSH tunnel configuration - direct connection
      ssh_tunnel:
        enabled: false
    
    # Additional US Data Warehouse Read-Only Direct
    US_DW_RO_DIRECT_WEST:
      host: us-west-2.ro.db.analysis.uniuni.com.internal
      port: 3306
      database: settlement
      username: "${DB_USER}"
      password: "${DB_US_DW_RO_PASSWORD}"
      description: "US Data Warehouse Read-Only MySQL (US-WEST-2) direct connection"
      
      # No SSH tunnel configuration - direct connection
      ssh_tunnel:
        enabled: false
    
    # US DB2 Read-Only with SSH
    US_DB2_RO_SSH:
      host: us-west-2.ro.db2.uniuni.com.internal
      port: 3306
      database: settlement
      username: "${DB_USER}"
      password: "${DB2_US_RO_PASSWORD}"
      description: "US DB2 Read-Only MySQL (US-WEST-2) via SSH tunnel"
      
      ssh_tunnel:
        enabled: true
        host: 35.83.114.196
        username: "${SSH_BASTION_USER}"
        private_key_path: "${SSH_BASTION_KEY_PATH}"
        local_port: 0  # Auto-assign
    
    # US DB2 Read-Only Direct (no SSH)
    US_DB2_RO_DIRECT:
      host: us-west-2.ro.db2.uniuni.com.internal
      port: 3306
      database: settlement
      username: "${DB_USER}"
      password: "${DB2_US_RO_PASSWORD}"
      description: "US DB2 Read-Only MySQL (US-WEST-2) direct connection"
      
      # No SSH tunnel configuration - direct connection
      ssh_tunnel:
        enabled: false
        
  # Target connections (Redshift)
  targets:
    redshift_default:
      host: redshift-dw.qa.uniuni.com
      port: 5439
      database: dw
      username: "${REDSHIFT_USER}"
      password: "${REDSHIFT_PASSWORD}"  # References .env variable
      schema: public
      
      # Redshift SSH tunnel (your separate bastion)
      ssh_tunnel:
        enabled: true
        host: 35.82.216.244
        username: "${REDSHIFT_SSH_BASTION_USER}"
        private_key_path: "${REDSHIFT_SSH_BASTION_KEY_PATH}"
        local_port: 0  # Auto-assign  
    
    redshift_default_direct:
      host: redshift-dw.qa.uniuni.com
      port: 5439
      database: dw
      username: "${REDSHIFT_USER}"
      password: "${REDSHIFT_PASSWORD}"  # References .env variable
      schema: public
      
      # Redshift SSH tunnel (your separate bastion)
      ssh_tunnel:
        enabled: false

    redshift_settlement_dws:  
      host: redshift-dw.uniuni.com
      port: 5439
      database: dw
      username: "${REDSHIFT_PRO_USER}"
      password: "${REDSHIFT_PRO_PASSWORD}" 
      schema: settlement_dws

      # Redshift SSH tunnel (your separate bastion)
      ssh_tunnel:
        enabled: true
        host: 35.83.114.196
        username: "${REDSHIFT_SSH_BASTION_USER}"
        private_key_path: "${REDSHIFT_SSH_BASTION_KEY_PATH}"
        local_port: 0  # Auto-assign 
    
    redshift_settlement_dws_direct: 
      host: redshift-dw.uniuni.com
      port: 5439
      database: dw
      username: "${REDSHIFT_PRO_USER}"
      password: "${REDSHIFT_PRO_PASSWORD}" 
      schema: settlement_dws

      # Redshift SSH tunnel (your separate bastion)
      ssh_tunnel:
        enabled: false

# S3 Configurations (Multiple environments supported)
# Each pipeline can reference a named S3 config via s3_config field
s3_configs:
  s3_qa:
    bucket_name: redshift-dw-qa-uniuni-com
    region: us-west-2
    access_key_id: "${AWS_ACCESS_KEY_ID}"
    secret_access_key: "${AWS_SECRET_ACCESS_KEY}"
    incremental_path: incremental/
    high_watermark_key: watermark/last_run_timestamp.txt
    description: "QA environment S3 bucket"

    # Performance optimizations
    performance:
      multipart_threshold: 104857600    # 100MB
      multipart_chunksize: 52428800     # 50MB
      max_concurrency: 10
      max_pool_connections: 20
      retry_max_attempts: 3
      retry_mode: adaptive

  s3_prod:
    bucket_name: redshift-dw-uniuni-com
    region: us-west-2
    access_key_id: "${AWS_ACCESS_KEY_ID}"
    secret_access_key: "${AWS_SECRET_ACCESS_KEY}"
    incremental_path: incremental/
    high_watermark_key: watermark/last_run_timestamp.txt
    description: "Production environment S3 bucket"

    # Performance optimizations
    performance:
      multipart_threshold: 104857600    # 100MB
      multipart_chunksize: 52428800     # 50MB
      max_concurrency: 10
      max_pool_connections: 20
      retry_max_attempts: 3
      retry_mode: adaptive

# Backup performance settings (from your optimized .env)
backup:
  batch_size: 1000000
  max_workers: 4
  timeout_seconds: 3600
  
  # Memory management
  memory_limit_mb: 6144
  gc_threshold: 500
  memory_check_interval: 5
  
  # Compression
  enable_compression: true
  compression_level: 6
